
> @mirubato/frontend@0.1.0 test
> jest --no-coverage --no-watch --passWithNoTests

FAIL unit src/utils/audioManager.test.ts
  AudioManager
    Initialization
      ✓ initializes audio system successfully (6 ms)
      ✓ does not reinitialize if already initialized (1 ms)
      ✓ waits for existing initialization if already loading
      ✓ handles initialization errors gracefully (9 ms)
      ✓ handles sample loading errors but continues (2 ms)
      ✓ logs successful sample loading (1 ms)
    Instrument Management
      ✓ sets and gets instrument correctly
    Note Playing
      ✓ plays a single note on piano (1 ms)
      ✓ plays multiple notes (chord) on piano
      ✓ plays a note on guitar (1 ms)
      ✓ initializes automatically on first play attempt
      ✕ handles play errors gracefully (1 ms)
      ✓ throws error if instrument not available (2 ms)
    Scheduled Note Playing
      ✓ schedules a note at specific time on piano
      ✓ schedules a chord at specific time on guitar (1 ms)
      ✓ initializes if needed before scheduling
      ✕ handles scheduling errors gracefully (1 ms)
    State Management
      ✓ correctly reports initialization state (2 ms)
      ✓ disposes resources correctly (5 ms)
      ✓ can reinitialize after disposal (1 ms)
    Edge Cases
      ✓ handles Tone.loaded rejection (1 ms)
      ✓ resets loading promise on error (1 ms)
      ✓ handles disposal during initialization (2 ms)

  ● AudioManager › Note Playing › handles play errors gracefully

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: undefined

      277 |       await audioManager.initialize()
      278 |
    > 279 |       await expect(audioManager.playNote('C4')).rejects.toThrow(
          |             ^
      280 |         'Playback failed'
      281 |       )
      282 |       expect(consoleErrorSpy).toHaveBeenCalledWith(

      at expect (../node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (src/utils/audioManager.test.ts:279:13)

  ● AudioManager › Scheduled Note Playing › handles scheduling errors gracefully

    expect(received).rejects.toThrow()

    Received promise resolved instead of rejected
    Resolved to value: undefined

      360 |       await audioManager.initialize()
      361 |
    > 362 |       await expect(audioManager.playNoteAt('C4', 1.0)).rejects.toThrow(
          |             ^
      363 |         'Scheduling failed'
      364 |       )
      365 |       expect(consoleErrorSpy).toHaveBeenCalledWith(

      at expect (../node_modules/expect/build/index.js:113:15)
      at Object.<anonymous> (src/utils/audioManager.test.ts:362:13)

  console.log
    Setting up test database...

      at Object.<anonymous> (tests/setup/integration.setup.ts:47:11)

PASS unit src/components/LandingPage.test.tsx
  LandingPage
    ✓ renders the main heading (28 ms)
    ✓ renders the tagline (5 ms)
    ✓ renders the start practice link (29 ms)
    ✓ renders the piano instructions (4 ms)
    ✓ renders the audio enable warning (6 ms)

  console.warn
    No more mocked responses for the query: query GetCurrentUser {
      me {
        id
        email
        displayName
        primaryInstrument
        createdAt
        updatedAt
        preferences {
          theme
          notationSize
          practiceReminders
          dailyGoalMinutes
          customSettings
        }
        stats {
          totalPracticeTime
          consecutiveDays
          piecesCompleted
          accuracyAverage
        }
      }
    }
    Expected variables: {}
    
    This typically indicates a configuration error in your mocks setup, usually due to a typo or mismatched variable.

      58 |       if (checkIsAuthenticated()) {
      59 |         try {
    > 60 |           const { data } = await apolloClient.query({
         |                                               ^
      61 |             query: GET_CURRENT_USER,
      62 |             fetchPolicy: 'network-only',
      63 |           })

      at MockLink.Object.<anonymous>.MockLink.request (../node_modules/@apollo/client/testing/core/mocking/mockLink.js:74:25)
      at Object.<anonymous>.ApolloLink.execute (../node_modules/@apollo/client/link/core/ApolloLink.js:47:22)
      at QueryManager.execute [as getObservableFromLink] (../node_modules/@apollo/client/core/QueryManager.js:742:25)
      at QueryManager.Object.<anonymous>.QueryManager.getResultsFromLink (../node_modules/@apollo/client/core/QueryManager.js:783:30)
      at resultsFromLink (../node_modules/@apollo/client/core/QueryManager.js:1109:26)
      at QueryManager.Object.<anonymous>.QueryManager.fetchQueryByPolicy (../node_modules/@apollo/client/core/QueryManager.js:1161:52)
      at fromVariables (../node_modules/@apollo/client/core/QueryManager.js:853:41)
      at QueryManager.Object.<anonymous>.QueryManager.fetchConcastWithInfo (../node_modules/@apollo/client/core/QueryManager.js:895:35)
      at QueryManager.Object.<anonymous>.QueryManager.fetchQuery (../node_modules/@apollo/client/core/QueryManager.js:382:21)
      at QueryManager.Object.<anonymous>.QueryManager.query (../node_modules/@apollo/client/core/QueryManager.js:480:21)
      at ApolloClient.Object.<anonymous>.ApolloClient.query (../node_modules/@apollo/client/core/ApolloClient.js:235:34)
      at initAuth (src/contexts/AuthContext.tsx:60:47)
      at src/contexts/AuthContext.tsx:105:5
      at commitHookEffectListMount (../node_modules/react-dom/cjs/react-dom.development.js:23189:26)
      at commitPassiveMountOnFiber (../node_modules/react-dom/cjs/react-dom.development.js:24970:11)
      at commitPassiveMountEffects_complete (../node_modules/react-dom/cjs/react-dom.development.js:24930:9)
      at commitPassiveMountEffects_begin (../node_modules/react-dom/cjs/react-dom.development.js:24917:7)
      at commitPassiveMountEffects (../node_modules/react-dom/cjs/react-dom.development.js:24905:3)
      at flushPassiveEffectsImpl (../node_modules/react-dom/cjs/react-dom.development.js:27078:3)
      at flushPassiveEffects (../node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at ../node_modules/react-dom/cjs/react-dom.development.js:26808:9
      at workLoop (../node_modules/scheduler/cjs/scheduler.development.js:266:34)
      at flushWork (../node_modules/scheduler/cjs/scheduler.development.js:239:14)
      at performWorkUntilDeadline (../node_modules/scheduler/cjs/scheduler.development.js:533:21)
      at Timeout.task [as _onTimeout] (../node_modules/jsdom/lib/jsdom/browser/Window.js:579:19)

PASS unit src/components/AuthModal.test.tsx
  AuthModal
    ✓ renders nothing when closed (27 ms)
    ✓ renders email form when open (27 ms)
    ✓ validates email input (15 ms)
    ✓ submits email and shows success state (28 ms)
    ✓ handles errors gracefully (11 ms)
    ✓ closes on escape key (5 ms)
    ✓ closes when clicking backdrop (5 ms)
    ✓ allows switching back to email form from success state (13 ms)

PASS unit src/pages/Practice.test.tsx
  Practice Page
    Component Rendering
      ✓ renders the practice page with all main sections (46 ms)
      ✓ renders mode selector on desktop (8 ms)
      ✓ hides mode selector on mobile (4 ms)
      ✓ shows mobile menu button on mobile (58 ms)
    Audio Initialization
      ✓ initializes audio manager on mount (8 ms)
      ✓ handles audio initialization errors (58 ms)
    Mode Selection
      ✓ changes mode when mode buttons are clicked (11 ms)
      ✓ shows debug controls in debug mode (10 ms)
      ✓ shows ghost controls in practice mode (5 ms)
    Volume Control
      ✓ updates volume when control is changed (6 ms)
      ✓ converts volume percentage to dB correctly (9 ms)
    Sheet Music Display Integration
      ✓ updates current playing measure from MusicPlayer (3 ms)
      ✓ clears current playing measure when stopped (4 ms)
    Responsive Behavior
      ✓ adapts layout for tablet viewport (3 ms)
      ✓ handles window resize events (9 ms)
    Navigation
      ✓ provides a back link to home (2 ms)
      ✓ shows close button (×) on mobile instead of Back (2 ms)
    Debug Mode Features
      ✓ toggles ghost control visibility in debug mode (5 ms)
    Component Cleanup
      ✓ removes event listeners on unmount (4 ms)

  console.warn
    No more mocked responses for the query: query GetCurrentUser {
      me {
        id
        email
        displayName
        primaryInstrument
        createdAt
        updatedAt
        preferences {
          theme
          notationSize
          practiceReminders
          dailyGoalMinutes
          customSettings
        }
        stats {
          totalPracticeTime
          consecutiveDays
          piecesCompleted
          accuracyAverage
        }
      }
    }
    Expected variables: {}
    
    This typically indicates a configuration error in your mocks setup, usually due to a typo or mismatched variable.

      58 |       if (checkIsAuthenticated()) {
      59 |         try {
    > 60 |           const { data } = await apolloClient.query({
         |                                               ^
      61 |             query: GET_CURRENT_USER,
      62 |             fetchPolicy: 'network-only',
      63 |           })

      at MockLink.Object.<anonymous>.MockLink.request (../node_modules/@apollo/client/testing/core/mocking/mockLink.js:74:25)
      at Object.<anonymous>.ApolloLink.execute (../node_modules/@apollo/client/link/core/ApolloLink.js:47:22)
      at QueryManager.execute [as getObservableFromLink] (../node_modules/@apollo/client/core/QueryManager.js:742:25)
      at QueryManager.Object.<anonymous>.QueryManager.getResultsFromLink (../node_modules/@apollo/client/core/QueryManager.js:783:30)
      at resultsFromLink (../node_modules/@apollo/client/core/QueryManager.js:1109:26)
      at QueryManager.Object.<anonymous>.QueryManager.fetchQueryByPolicy (../node_modules/@apollo/client/core/QueryManager.js:1161:52)
      at fromVariables (../node_modules/@apollo/client/core/QueryManager.js:853:41)
      at QueryManager.Object.<anonymous>.QueryManager.fetchConcastWithInfo (../node_modules/@apollo/client/core/QueryManager.js:895:35)
      at QueryManager.Object.<anonymous>.QueryManager.fetchQuery (../node_modules/@apollo/client/core/QueryManager.js:382:21)
      at QueryManager.Object.<anonymous>.QueryManager.query (../node_modules/@apollo/client/core/QueryManager.js:480:21)
      at ApolloClient.Object.<anonymous>.ApolloClient.query (../node_modules/@apollo/client/core/ApolloClient.js:235:34)
      at initAuth (src/contexts/AuthContext.tsx:60:47)
      at src/contexts/AuthContext.tsx:105:5
      at commitHookEffectListMount (../node_modules/react-dom/cjs/react-dom.development.js:23189:26)
      at commitPassiveMountOnFiber (../node_modules/react-dom/cjs/react-dom.development.js:24970:11)
      at commitPassiveMountEffects_complete (../node_modules/react-dom/cjs/react-dom.development.js:24930:9)
      at commitPassiveMountEffects_begin (../node_modules/react-dom/cjs/react-dom.development.js:24917:7)
      at commitPassiveMountEffects (../node_modules/react-dom/cjs/react-dom.development.js:24905:3)
      at flushPassiveEffectsImpl (../node_modules/react-dom/cjs/react-dom.development.js:27078:3)
      at flushPassiveEffects (../node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at ../node_modules/react-dom/cjs/react-dom.development.js:26808:9
      at workLoop (../node_modules/scheduler/cjs/scheduler.development.js:266:34)
      at flushWork (../node_modules/scheduler/cjs/scheduler.development.js:239:14)
      at performWorkUntilDeadline (../node_modules/scheduler/cjs/scheduler.development.js:533:21)
      at Timeout.task [as _onTimeout] (../node_modules/jsdom/lib/jsdom/browser/Window.js:579:19)

  console.warn
    No more mocked responses for the query: query GetCurrentUser {
      me {
        id
        email
        displayName
        primaryInstrument
        createdAt
        updatedAt
        preferences {
          theme
          notationSize
          practiceReminders
          dailyGoalMinutes
          customSettings
        }
        stats {
          totalPracticeTime
          consecutiveDays
          piecesCompleted
          accuracyAverage
        }
      }
    }
    Expected variables: {}
    
    This typically indicates a configuration error in your mocks setup, usually due to a typo or mismatched variable.

      58 |       if (checkIsAuthenticated()) {
      59 |         try {
    > 60 |           const { data } = await apolloClient.query({
         |                                               ^
      61 |             query: GET_CURRENT_USER,
      62 |             fetchPolicy: 'network-only',
      63 |           })

      at MockLink.Object.<anonymous>.MockLink.request (../node_modules/@apollo/client/testing/core/mocking/mockLink.js:74:25)
      at Object.<anonymous>.ApolloLink.execute (../node_modules/@apollo/client/link/core/ApolloLink.js:47:22)
      at QueryManager.execute [as getObservableFromLink] (../node_modules/@apollo/client/core/QueryManager.js:742:25)
      at QueryManager.Object.<anonymous>.QueryManager.getResultsFromLink (../node_modules/@apollo/client/core/QueryManager.js:783:30)
      at resultsFromLink (../node_modules/@apollo/client/core/QueryManager.js:1109:26)
      at QueryManager.Object.<anonymous>.QueryManager.fetchQueryByPolicy (../node_modules/@apollo/client/core/QueryManager.js:1161:52)
      at fromVariables (../node_modules/@apollo/client/core/QueryManager.js:853:41)
      at QueryManager.Object.<anonymous>.QueryManager.fetchConcastWithInfo (../node_modules/@apollo/client/core/QueryManager.js:895:35)
      at QueryManager.Object.<anonymous>.QueryManager.fetchQuery (../node_modules/@apollo/client/core/QueryManager.js:382:21)
      at QueryManager.Object.<anonymous>.QueryManager.query (../node_modules/@apollo/client/core/QueryManager.js:480:21)
      at ApolloClient.Object.<anonymous>.ApolloClient.query (../node_modules/@apollo/client/core/ApolloClient.js:235:34)
      at initAuth (src/contexts/AuthContext.tsx:60:47)
      at src/contexts/AuthContext.tsx:105:5
      at commitHookEffectListMount (../node_modules/react-dom/cjs/react-dom.development.js:23189:26)
      at commitPassiveMountOnFiber (../node_modules/react-dom/cjs/react-dom.development.js:24970:11)
      at commitPassiveMountEffects_complete (../node_modules/react-dom/cjs/react-dom.development.js:24930:9)
      at commitPassiveMountEffects_begin (../node_modules/react-dom/cjs/react-dom.development.js:24917:7)
      at commitPassiveMountEffects (../node_modules/react-dom/cjs/react-dom.development.js:24905:3)
      at flushPassiveEffectsImpl (../node_modules/react-dom/cjs/react-dom.development.js:27078:3)
      at flushPassiveEffects (../node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at ../node_modules/react-dom/cjs/react-dom.development.js:26808:9
      at workLoop (../node_modules/scheduler/cjs/scheduler.development.js:266:34)
      at flushWork (../node_modules/scheduler/cjs/scheduler.development.js:239:14)
      at performWorkUntilDeadline (../node_modules/scheduler/cjs/scheduler.development.js:533:21)
      at Timeout.task [as _onTimeout] (../node_modules/jsdom/lib/jsdom/browser/Window.js:579:19)

PASS unit src/components/CircularControl.test.tsx
  CircularControl
    Rendering
      ✓ renders with default props (16 ms)
      ✓ renders with custom label (3 ms)
      ✓ renders with custom size (3 ms)
      ✓ renders without label when not provided (9 ms)
      ✓ applies disabled styles when disabled (2 ms)
      ✓ applies ghost opacity when ghost prop is true (24 ms)
      ✓ applies custom className (1 ms)
    Value to Angle Conversion
      ✓ converts value 0 to -135 degrees (1 ms)
      ✓ converts value 50 to 0 degrees (2 ms)
      ✓ converts value 100 to 135 degrees (2 ms)
    Mouse Interactions
      ✓ starts dragging on mousedown (7 ms)
      ✓ does not start dragging when disabled (2 ms)
      ✓ updates value on mouse drag (2 ms)
      ✓ stops dragging on mouseup (3 ms)
      ✓ limits value between 0 and 100 (1 ms)
    Touch Interactions
      ✓ starts dragging on touchstart
      ✓ updates value on touch drag (1 ms)
      ✓ stops dragging on touchend (1 ms)
      ✓ has touch-action none to prevent scrolling (1 ms)
    Event Listener Cleanup
      ✓ removes event listeners on unmount (1 ms)
      ✓ removes event listeners when dragging ends (5 ms)
    Ghost Mode
      ✓ shows low opacity when ghost and not dragging (3 ms)
      ✓ increases opacity slightly when ghost and dragging (4 ms)

  console.warn
    No more mocked responses for the query: query GetCurrentUser {
      me {
        id
        email
        displayName
        primaryInstrument
        createdAt
        updatedAt
        preferences {
          theme
          notationSize
          practiceReminders
          dailyGoalMinutes
          customSettings
        }
        stats {
          totalPracticeTime
          consecutiveDays
          piecesCompleted
          accuracyAverage
        }
      }
    }
    Expected variables: {}
    
    This typically indicates a configuration error in your mocks setup, usually due to a typo or mismatched variable.

      58 |       if (checkIsAuthenticated()) {
      59 |         try {
    > 60 |           const { data } = await apolloClient.query({
         |                                               ^
      61 |             query: GET_CURRENT_USER,
      62 |             fetchPolicy: 'network-only',
      63 |           })

      at MockLink.Object.<anonymous>.MockLink.request (../node_modules/@apollo/client/testing/core/mocking/mockLink.js:74:25)
      at Object.<anonymous>.ApolloLink.execute (../node_modules/@apollo/client/link/core/ApolloLink.js:47:22)
      at QueryManager.execute [as getObservableFromLink] (../node_modules/@apollo/client/core/QueryManager.js:742:25)
      at QueryManager.Object.<anonymous>.QueryManager.getResultsFromLink (../node_modules/@apollo/client/core/QueryManager.js:783:30)
      at resultsFromLink (../node_modules/@apollo/client/core/QueryManager.js:1109:26)
      at QueryManager.Object.<anonymous>.QueryManager.fetchQueryByPolicy (../node_modules/@apollo/client/core/QueryManager.js:1161:52)
      at fromVariables (../node_modules/@apollo/client/core/QueryManager.js:853:41)
      at QueryManager.Object.<anonymous>.QueryManager.fetchConcastWithInfo (../node_modules/@apollo/client/core/QueryManager.js:895:35)
      at QueryManager.Object.<anonymous>.QueryManager.fetchQuery (../node_modules/@apollo/client/core/QueryManager.js:382:21)
      at QueryManager.Object.<anonymous>.QueryManager.query (../node_modules/@apollo/client/core/QueryManager.js:480:21)
      at ApolloClient.Object.<anonymous>.ApolloClient.query (../node_modules/@apollo/client/core/ApolloClient.js:235:34)
      at initAuth (src/contexts/AuthContext.tsx:60:47)
      at src/contexts/AuthContext.tsx:105:5
      at commitHookEffectListMount (../node_modules/react-dom/cjs/react-dom.development.js:23189:26)
      at commitPassiveMountOnFiber (../node_modules/react-dom/cjs/react-dom.development.js:24970:11)
      at commitPassiveMountEffects_complete (../node_modules/react-dom/cjs/react-dom.development.js:24930:9)
      at commitPassiveMountEffects_begin (../node_modules/react-dom/cjs/react-dom.development.js:24917:7)
      at commitPassiveMountEffects (../node_modules/react-dom/cjs/react-dom.development.js:24905:3)
      at flushPassiveEffectsImpl (../node_modules/react-dom/cjs/react-dom.development.js:27078:3)
      at flushPassiveEffects (../node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at ../node_modules/react-dom/cjs/react-dom.development.js:26808:9
      at workLoop (../node_modules/scheduler/cjs/scheduler.development.js:266:34)
      at flushWork (../node_modules/scheduler/cjs/scheduler.development.js:239:14)
      at performWorkUntilDeadline (../node_modules/scheduler/cjs/scheduler.development.js:533:21)
      at Timeout.task [as _onTimeout] (../node_modules/jsdom/lib/jsdom/browser/Window.js:579:19)

  console.warn
    No more mocked responses for the query: query GetCurrentUser {
      me {
        id
        email
        displayName
        primaryInstrument
        createdAt
        updatedAt
        preferences {
          theme
          notationSize
          practiceReminders
          dailyGoalMinutes
          customSettings
        }
        stats {
          totalPracticeTime
          consecutiveDays
          piecesCompleted
          accuracyAverage
        }
      }
    }
    Expected variables: {}
    
    This typically indicates a configuration error in your mocks setup, usually due to a typo or mismatched variable.

      58 |       if (checkIsAuthenticated()) {
      59 |         try {
    > 60 |           const { data } = await apolloClient.query({
         |                                               ^
      61 |             query: GET_CURRENT_USER,
      62 |             fetchPolicy: 'network-only',
      63 |           })

      at MockLink.Object.<anonymous>.MockLink.request (../node_modules/@apollo/client/testing/core/mocking/mockLink.js:74:25)
      at Object.<anonymous>.ApolloLink.execute (../node_modules/@apollo/client/link/core/ApolloLink.js:47:22)
      at QueryManager.execute [as getObservableFromLink] (../node_modules/@apollo/client/core/QueryManager.js:742:25)
      at QueryManager.Object.<anonymous>.QueryManager.getResultsFromLink (../node_modules/@apollo/client/core/QueryManager.js:783:30)
      at resultsFromLink (../node_modules/@apollo/client/core/QueryManager.js:1109:26)
      at QueryManager.Object.<anonymous>.QueryManager.fetchQueryByPolicy (../node_modules/@apollo/client/core/QueryManager.js:1161:52)
      at fromVariables (../node_modules/@apollo/client/core/QueryManager.js:853:41)
      at QueryManager.Object.<anonymous>.QueryManager.fetchConcastWithInfo (../node_modules/@apollo/client/core/QueryManager.js:895:35)
      at QueryManager.Object.<anonymous>.QueryManager.fetchQuery (../node_modules/@apollo/client/core/QueryManager.js:382:21)
      at QueryManager.Object.<anonymous>.QueryManager.query (../node_modules/@apollo/client/core/QueryManager.js:480:21)
      at ApolloClient.Object.<anonymous>.ApolloClient.query (../node_modules/@apollo/client/core/ApolloClient.js:235:34)
      at initAuth (src/contexts/AuthContext.tsx:60:47)
      at src/contexts/AuthContext.tsx:105:5
      at commitHookEffectListMount (../node_modules/react-dom/cjs/react-dom.development.js:23189:26)
      at commitPassiveMountOnFiber (../node_modules/react-dom/cjs/react-dom.development.js:24970:11)
      at commitPassiveMountEffects_complete (../node_modules/react-dom/cjs/react-dom.development.js:24930:9)
      at commitPassiveMountEffects_begin (../node_modules/react-dom/cjs/react-dom.development.js:24917:7)
      at commitPassiveMountEffects (../node_modules/react-dom/cjs/react-dom.development.js:24905:3)
      at flushPassiveEffectsImpl (../node_modules/react-dom/cjs/react-dom.development.js:27078:3)
      at flushPassiveEffects (../node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at ../node_modules/react-dom/cjs/react-dom.development.js:26808:9
      at workLoop (../node_modules/scheduler/cjs/scheduler.development.js:266:34)
      at flushWork (../node_modules/scheduler/cjs/scheduler.development.js:239:14)
      at performWorkUntilDeadline (../node_modules/scheduler/cjs/scheduler.development.js:533:21)
      at Timeout.task [as _onTimeout] (../node_modules/jsdom/lib/jsdom/browser/Window.js:579:19)

  console.error
    Error parsing user data: SyntaxError: Unexpected token 'i', "invalid json{" is not valid JSON
        at JSON.parse (<anonymous>)
        at LocalStorageService.getUserData (/Users/arbeitandy/src/public/rubato.pezware.com/frontend/src/services/localStorage.ts:40:29)
        at Object.<anonymous> (/Users/arbeitandy/src/public/rubato.pezware.com/frontend/src/__tests__/unit/services/localStorage.test.ts:461:44)
        at Promise.then.completed (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-circus/build/run.js:121:9)
        at run (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-runner/build/runTest.js:444:34)
        at Object.worker (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-runner/build/testWorker.js:106:12)

      134 |       return
      135 |     }
    > 136 |     originalError.call(console, ...args)
          |                   ^
      137 |   }
      138 | })
      139 |

      at console.error (src/tests/setup/unit.setup.ts:136:19)
      at LocalStorageService.getUserData (src/services/localStorage.ts:57:15)
      at Object.<anonymous> (src/__tests__/unit/services/localStorage.test.ts:461:44)

  console.error
    Error saving user data: Error: QuotaExceededError
        at Proxy.<anonymous> (/Users/arbeitandy/src/public/rubato.pezware.com/frontend/src/__tests__/unit/services/localStorage.test.ts:488:15)
        at /Users/arbeitandy/src/public/rubato.pezware.com/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:305:39
        at Proxy.<anonymous> (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:312:13)
        at Proxy.mockConstructor (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:102:19)
        at LocalStorageService.setUserData (/Users/arbeitandy/src/public/rubato.pezware.com/frontend/src/services/localStorage.ts:67:20)
        at LocalStorageService.createAnonymousUser (/Users/arbeitandy/src/public/rubato.pezware.com/frontend/src/services/localStorage.ts:108:10)
        at LocalStorageService.getUserData (/Users/arbeitandy/src/public/rubato.pezware.com/frontend/src/services/localStorage.ts:36:36)
        at Object.<anonymous> (/Users/arbeitandy/src/public/rubato.pezware.com/frontend/src/__tests__/unit/services/localStorage.test.ts:491:44)
        at Promise.then.completed (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-circus/build/run.js:121:9)
        at run (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-runner/build/runTest.js:444:34)
        at Object.worker (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-runner/build/testWorker.js:106:12)

      134 |       return
      135 |     }
    > 136 |     originalError.call(console, ...args)
          |                   ^
      137 |   }
      138 | })
      139 |

      at console.error (src/tests/setup/unit.setup.ts:136:19)
      at LocalStorageService.setUserData (src/services/localStorage.ts:69:15)
      at LocalStorageService.createAnonymousUser (src/services/localStorage.ts:108:10)
      at LocalStorageService.getUserData (src/services/localStorage.ts:36:36)
      at Object.<anonymous> (src/__tests__/unit/services/localStorage.test.ts:491:44)

  console.error
    Error saving user data: Error: QuotaExceededError
        at Proxy.<anonymous> (/Users/arbeitandy/src/public/rubato.pezware.com/frontend/src/__tests__/unit/services/localStorage.test.ts:488:15)
        at /Users/arbeitandy/src/public/rubato.pezware.com/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:305:39
        at Proxy.<anonymous> (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:312:13)
        at Proxy.mockConstructor (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:102:19)
        at LocalStorageService.setUserData (/Users/arbeitandy/src/public/rubato.pezware.com/frontend/src/services/localStorage.ts:67:20)
        at LocalStorageService.getUserData (/Users/arbeitandy/src/public/rubato.pezware.com/frontend/src/services/localStorage.ts:37:14)
        at Object.<anonymous> (/Users/arbeitandy/src/public/rubato.pezware.com/frontend/src/__tests__/unit/services/localStorage.test.ts:491:44)
        at Promise.then.completed (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-circus/build/run.js:121:9)
        at run (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-runner/build/runTest.js:444:34)
        at Object.worker (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-runner/build/testWorker.js:106:12)

      134 |       return
      135 |     }
    > 136 |     originalError.call(console, ...args)
          |                   ^
      137 |   }
      138 | })
      139 |

      at console.error (src/tests/setup/unit.setup.ts:136:19)
      at LocalStorageService.setUserData (src/services/localStorage.ts:69:15)
      at LocalStorageService.getUserData (src/services/localStorage.ts:37:14)
      at Object.<anonymous> (src/__tests__/unit/services/localStorage.test.ts:491:44)

  console.error
    Error saving practice session: Error: QuotaExceededError
        at Proxy.<anonymous> (/Users/arbeitandy/src/public/rubato.pezware.com/frontend/src/__tests__/unit/services/localStorage.test.ts:488:15)
        at /Users/arbeitandy/src/public/rubato.pezware.com/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:305:39
        at Proxy.<anonymous> (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:312:13)
        at Proxy.mockConstructor (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/@jest/environment-jsdom-abstract/node_modules/jest-mock/build/index.js:102:19)
        at LocalStorageService.savePracticeSession (/Users/arbeitandy/src/public/rubato.pezware.com/frontend/src/services/localStorage.ts:157:20)
        at /Users/arbeitandy/src/public/rubato.pezware.com/frontend/src/__tests__/unit/services/localStorage.test.ts:506:29
        at Object.<anonymous> (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/expect/build/toThrowMatchers.js:74:11)
        at Object.throwingMatcher [as toThrow] (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/expect/build/index.js:320:21)
        at Object.<anonymous> (/Users/arbeitandy/src/public/rubato.pezware.com/frontend/src/__tests__/unit/services/localStorage.test.ts:507:14)
        at Promise.then.completed (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-circus/build/utils.js:298:28)
        at new Promise (<anonymous>)
        at callAsyncCircusFn (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-circus/build/utils.js:231:10)
        at _callCircusTest (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-circus/build/run.js:316:40)
        at processTicksAndRejections (node:internal/process/task_queues:105:5)
        at _runTest (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-circus/build/run.js:252:3)
        at _runTestsForDescribeBlock (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-circus/build/run.js:126:9)
        at _runTestsForDescribeBlock (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-circus/build/run.js:121:9)
        at _runTestsForDescribeBlock (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-circus/build/run.js:121:9)
        at run (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-circus/build/run.js:71:3)
        at runAndTransformResultsToJestFormat (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapterInit.js:122:21)
        at jestAdapter (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-circus/build/legacy-code-todo-rewrite/jestAdapter.js:79:19)
        at runTestInternal (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-runner/build/runTest.js:367:16)
        at runTest (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-runner/build/runTest.js:444:34)
        at Object.worker (/Users/arbeitandy/src/public/rubato.pezware.com/node_modules/jest-runner/build/testWorker.js:106:12)

      134 |       return
      135 |     }
    > 136 |     originalError.call(console, ...args)
          |                   ^
      137 |   }
      138 | })
      139 |

      at console.error (src/tests/setup/unit.setup.ts:136:19)
      at LocalStorageService.savePracticeSession (src/services/localStorage.ts:165:15)
      at src/__tests__/unit/services/localStorage.test.ts:506:29
      at Object.<anonymous> (../node_modules/expect/build/toThrowMatchers.js:74:11)
      at Object.throwingMatcher [as toThrow] (../node_modules/expect/build/index.js:320:21)
      at Object.<anonymous> (src/__tests__/unit/services/localStorage.test.ts:507:14)

PASS unit src/__tests__/unit/services/localStorage.test.ts
  localStorageService
    Anonymous User Management
      ✓ should create anonymous user on first visit (1 ms)
      ✓ should persist anonymous user data
      ✓ should initialize anonymous user on getUserData if none exists (1 ms)
    Authenticated User Management
      ✓ should update user data for authenticated user
      ✓ should clear all local data on clearAllData (1 ms)
    Practice Session Management
      ✓ should save practice session
      ✓ should update user stats when saving completed session (1 ms)
      ✓ should handle multiple sessions for average accuracy (1 ms)
    Practice Log Management
      ✓ should save practice log
      ✓ should get logs by session ID
    Sync Management
      ✓ should get pending sync data for unsynced items
      ✓ should mark items as synced
      ✓ should handle migration from anonymous to authenticated user
    User Preferences
      ✓ should update user preferences (1 ms)
      ✓ should update primary instrument (2 ms)
    Edge Cases and Error Handling
      ✓ should handle corrupt localStorage data gracefully (29 ms)
      ✓ should handle missing required fields in stored data (1 ms)
      ✓ should handle localStorage quota exceeded (7 ms)
      ✓ should filter out invalid sessions when retrieving

PASS unit src/utils/notationRenderer.test.ts
  NotationRenderer
    Initialization
      ✓ creates a NotationRenderer with container (1 ms)
    Rendering
      ✓ renders sheet music with default options (2 ms)
      ✓ renders with custom measures per line (2 ms)
      ✓ renders with start measure number
      ✓ handles different scale values
      ✓ clears previous content before rendering (1 ms)
      ✓ creates beams for sixteenth notes
      ✓ does not create beams for non-sixteenth notes
      ✓ handles measures without optional properties (1 ms)
      ✓ calculates proper dimensions for different layouts (1 ms)
    Disposal
      ✓ cleans up resources on dispose
      ✓ can dispose without rendering
      ✓ can dispose multiple times (1 ms)
    Edge Cases
      ✓ handles empty measures array (3 ms)
      ✓ handles very small width (1 ms)
      ✓ handles very large scale
      ✓ handles partial beams at end of measure

  console.warn
    No more mocked responses for the query: query GetCurrentUser {
      me {
        id
        email
        displayName
        primaryInstrument
        createdAt
        updatedAt
        preferences {
          theme
          notationSize
          practiceReminders
          dailyGoalMinutes
          customSettings
        }
        stats {
          totalPracticeTime
          consecutiveDays
          piecesCompleted
          accuracyAverage
        }
      }
    }
    Expected variables: {}
    
    This typically indicates a configuration error in your mocks setup, usually due to a typo or mismatched variable.

      58 |       if (checkIsAuthenticated()) {
      59 |         try {
    > 60 |           const { data } = await apolloClient.query({
         |                                               ^
      61 |             query: GET_CURRENT_USER,
      62 |             fetchPolicy: 'network-only',
      63 |           })

      at MockLink.Object.<anonymous>.MockLink.request (../node_modules/@apollo/client/testing/core/mocking/mockLink.js:74:25)
      at Object.<anonymous>.ApolloLink.execute (../node_modules/@apollo/client/link/core/ApolloLink.js:47:22)
      at QueryManager.execute [as getObservableFromLink] (../node_modules/@apollo/client/core/QueryManager.js:742:25)
      at QueryManager.Object.<anonymous>.QueryManager.getResultsFromLink (../node_modules/@apollo/client/core/QueryManager.js:783:30)
      at resultsFromLink (../node_modules/@apollo/client/core/QueryManager.js:1109:26)
      at QueryManager.Object.<anonymous>.QueryManager.fetchQueryByPolicy (../node_modules/@apollo/client/core/QueryManager.js:1161:52)
      at fromVariables (../node_modules/@apollo/client/core/QueryManager.js:853:41)
      at QueryManager.Object.<anonymous>.QueryManager.fetchConcastWithInfo (../node_modules/@apollo/client/core/QueryManager.js:895:35)
      at QueryManager.Object.<anonymous>.QueryManager.fetchQuery (../node_modules/@apollo/client/core/QueryManager.js:382:21)
      at QueryManager.Object.<anonymous>.QueryManager.query (../node_modules/@apollo/client/core/QueryManager.js:480:21)
      at ApolloClient.Object.<anonymous>.ApolloClient.query (../node_modules/@apollo/client/core/ApolloClient.js:235:34)
      at initAuth (src/contexts/AuthContext.tsx:60:47)
      at src/contexts/AuthContext.tsx:105:5
      at commitHookEffectListMount (../node_modules/react-dom/cjs/react-dom.development.js:23189:26)
      at commitPassiveMountOnFiber (../node_modules/react-dom/cjs/react-dom.development.js:24970:11)
      at commitPassiveMountEffects_complete (../node_modules/react-dom/cjs/react-dom.development.js:24930:9)
      at commitPassiveMountEffects_begin (../node_modules/react-dom/cjs/react-dom.development.js:24917:7)
      at commitPassiveMountEffects (../node_modules/react-dom/cjs/react-dom.development.js:24905:3)
      at flushPassiveEffectsImpl (../node_modules/react-dom/cjs/react-dom.development.js:27078:3)
      at flushPassiveEffects (../node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at ../node_modules/react-dom/cjs/react-dom.development.js:26808:9
      at workLoop (../node_modules/scheduler/cjs/scheduler.development.js:266:34)
      at flushWork (../node_modules/scheduler/cjs/scheduler.development.js:239:14)
      at performWorkUntilDeadline (../node_modules/scheduler/cjs/scheduler.development.js:533:21)
      at Timeout.task [as _onTimeout] (../node_modules/jsdom/lib/jsdom/browser/Window.js:579:19)

  console.log
    Syncing to cloud: {
      sessions: [
        {
          id: 'session-1',
          userId: 'user-123',
          instrument: 'PIANO',
          sessionType: 'FREE_PRACTICE',
          startedAt: '2024-01-01T00:00:00.000Z',
          pausedDuration: 0,
          notesAttempted: 100,
          notesCorrect: 90,
          isSynced: false
        },
        {
          id: 'session-2',
          userId: 'user-123',
          instrument: 'PIANO',
          sessionType: 'GUIDED_PRACTICE',
          startedAt: '2024-01-01T01:00:00.000Z',
          pausedDuration: 0,
          notesAttempted: 50,
          notesCorrect: 45,
          isSynced: false
        }
      ],
      logs: [
        {
          id: 'log-1',
          sessionId: 'session-1',
          activityType: 'SIGHT_READING',
          durationSeconds: 300,
          createdAt: '2024-01-01T00:00:00.000Z'
        },
        {
          id: 'log-2',
          sessionId: 'session-2',
          activityType: 'SCALES',
          durationSeconds: 600,
          createdAt: '2024-01-01T01:00:00.000Z'
        }
      ]
    }

      at Object.syncToCloud (src/contexts/AuthContext.tsx:213:15)

  console.warn
    No more mocked responses for the query: query GetCurrentUser {
      me {
        id
        email
        displayName
        primaryInstrument
        createdAt
        updatedAt
        preferences {
          theme
          notationSize
          practiceReminders
          dailyGoalMinutes
          customSettings
        }
        stats {
          totalPracticeTime
          consecutiveDays
          piecesCompleted
          accuracyAverage
        }
      }
    }
    Expected variables: {}
    
    This typically indicates a configuration error in your mocks setup, usually due to a typo or mismatched variable.

      58 |       if (checkIsAuthenticated()) {
      59 |         try {
    > 60 |           const { data } = await apolloClient.query({
         |                                               ^
      61 |             query: GET_CURRENT_USER,
      62 |             fetchPolicy: 'network-only',
      63 |           })

      at MockLink.Object.<anonymous>.MockLink.request (../node_modules/@apollo/client/testing/core/mocking/mockLink.js:74:25)
      at Object.<anonymous>.ApolloLink.execute (../node_modules/@apollo/client/link/core/ApolloLink.js:47:22)
      at QueryManager.execute [as getObservableFromLink] (../node_modules/@apollo/client/core/QueryManager.js:742:25)
      at QueryManager.Object.<anonymous>.QueryManager.getResultsFromLink (../node_modules/@apollo/client/core/QueryManager.js:783:30)
      at resultsFromLink (../node_modules/@apollo/client/core/QueryManager.js:1109:26)
      at QueryManager.Object.<anonymous>.QueryManager.fetchQueryByPolicy (../node_modules/@apollo/client/core/QueryManager.js:1161:52)
      at fromVariables (../node_modules/@apollo/client/core/QueryManager.js:853:41)
      at QueryManager.Object.<anonymous>.QueryManager.fetchConcastWithInfo (../node_modules/@apollo/client/core/QueryManager.js:895:35)
      at QueryManager.Object.<anonymous>.QueryManager.fetchQuery (../node_modules/@apollo/client/core/QueryManager.js:382:21)
      at QueryManager.Object.<anonymous>.QueryManager.query (../node_modules/@apollo/client/core/QueryManager.js:480:21)
      at ApolloClient.Object.<anonymous>.ApolloClient.query (../node_modules/@apollo/client/core/ApolloClient.js:235:34)
      at initAuth (src/contexts/AuthContext.tsx:60:47)
      at src/contexts/AuthContext.tsx:105:5
      at commitHookEffectListMount (../node_modules/react-dom/cjs/react-dom.development.js:23189:26)
      at commitPassiveMountOnFiber (../node_modules/react-dom/cjs/react-dom.development.js:24970:11)
      at commitPassiveMountEffects_complete (../node_modules/react-dom/cjs/react-dom.development.js:24930:9)
      at commitPassiveMountEffects_begin (../node_modules/react-dom/cjs/react-dom.development.js:24917:7)
      at commitPassiveMountEffects (../node_modules/react-dom/cjs/react-dom.development.js:24905:3)
      at flushPassiveEffectsImpl (../node_modules/react-dom/cjs/react-dom.development.js:27078:3)
      at flushPassiveEffects (../node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at ../node_modules/react-dom/cjs/react-dom.development.js:26808:9
      at workLoop (../node_modules/scheduler/cjs/scheduler.development.js:266:34)
      at flushWork (../node_modules/scheduler/cjs/scheduler.development.js:239:14)
      at performWorkUntilDeadline (../node_modules/scheduler/cjs/scheduler.development.js:533:21)
      at Timeout.task [as _onTimeout] (../node_modules/jsdom/lib/jsdom/browser/Window.js:579:19)

  console.warn
    No more mocked responses for the query: query GetCurrentUser {
      me {
        id
        email
        displayName
        primaryInstrument
        createdAt
        updatedAt
        preferences {
          theme
          notationSize
          practiceReminders
          dailyGoalMinutes
          customSettings
        }
        stats {
          totalPracticeTime
          consecutiveDays
          piecesCompleted
          accuracyAverage
        }
      }
    }
    Expected variables: {}
    
    This typically indicates a configuration error in your mocks setup, usually due to a typo or mismatched variable.

      58 |       if (checkIsAuthenticated()) {
      59 |         try {
    > 60 |           const { data } = await apolloClient.query({
         |                                               ^
      61 |             query: GET_CURRENT_USER,
      62 |             fetchPolicy: 'network-only',
      63 |           })

      at MockLink.Object.<anonymous>.MockLink.request (../node_modules/@apollo/client/testing/core/mocking/mockLink.js:74:25)
      at Object.<anonymous>.ApolloLink.execute (../node_modules/@apollo/client/link/core/ApolloLink.js:47:22)
      at QueryManager.execute [as getObservableFromLink] (../node_modules/@apollo/client/core/QueryManager.js:742:25)
      at QueryManager.Object.<anonymous>.QueryManager.getResultsFromLink (../node_modules/@apollo/client/core/QueryManager.js:783:30)
      at resultsFromLink (../node_modules/@apollo/client/core/QueryManager.js:1109:26)
      at QueryManager.Object.<anonymous>.QueryManager.fetchQueryByPolicy (../node_modules/@apollo/client/core/QueryManager.js:1161:52)
      at fromVariables (../node_modules/@apollo/client/core/QueryManager.js:853:41)
      at QueryManager.Object.<anonymous>.QueryManager.fetchConcastWithInfo (../node_modules/@apollo/client/core/QueryManager.js:895:35)
      at QueryManager.Object.<anonymous>.QueryManager.fetchQuery (../node_modules/@apollo/client/core/QueryManager.js:382:21)
      at QueryManager.Object.<anonymous>.QueryManager.query (../node_modules/@apollo/client/core/QueryManager.js:480:21)
      at ApolloClient.Object.<anonymous>.ApolloClient.query (../node_modules/@apollo/client/core/ApolloClient.js:235:34)
      at initAuth (src/contexts/AuthContext.tsx:60:47)
      at src/contexts/AuthContext.tsx:105:5
      at commitHookEffectListMount (../node_modules/react-dom/cjs/react-dom.development.js:23189:26)
      at commitPassiveMountOnFiber (../node_modules/react-dom/cjs/react-dom.development.js:24970:11)
      at commitPassiveMountEffects_complete (../node_modules/react-dom/cjs/react-dom.development.js:24930:9)
      at commitPassiveMountEffects_begin (../node_modules/react-dom/cjs/react-dom.development.js:24917:7)
      at commitPassiveMountEffects (../node_modules/react-dom/cjs/react-dom.development.js:24905:3)
      at flushPassiveEffectsImpl (../node_modules/react-dom/cjs/react-dom.development.js:27078:3)
      at flushPassiveEffects (../node_modules/react-dom/cjs/react-dom.development.js:27023:14)
      at ../node_modules/react-dom/cjs/react-dom.development.js:26808:9
      at workLoop (../node_modules/scheduler/cjs/scheduler.development.js:266:34)
      at flushWork (../node_modules/scheduler/cjs/scheduler.development.js:239:14)
      at performWorkUntilDeadline (../node_modules/scheduler/cjs/scheduler.development.js:533:21)
      at Timeout.task [as _onTimeout] (../node_modules/jsdom/lib/jsdom/browser/Window.js:579:19)

PASS unit src/contexts/AuthContext.test.tsx
  AuthContext
    Initialization
      ✓ creates anonymous user when no user exists (28 ms)
      ✓ loads existing anonymous user (6 ms)
      ✓ loads authenticated user on mount (64 ms)
      ✓ handles failed user fetch and clears tokens (9 ms)
    Login
      ✓ successfully logs in and migrates anonymous user data (25 ms)
      ✓ handles login errors gracefully (14 ms)
    Logout
      ✓ logs out authenticated user and creates anonymous user (17 ms)
      ✓ handles logout errors but still clears auth (15 ms)
    Token Refresh
      ✓ successfully refreshes tokens (59 ms)
      ✓ handles refresh token errors (9 ms)
      ✓ throws error when no refresh token available (5 ms)
    Cloud Sync
      ✓ redirects anonymous users to login (3 ms)
      ✓ syncs data for authenticated users (13 ms)
      ✓ handles sync errors (8 ms)
    Context Value
      ✓ provides correct context values (16 ms)

  console.log
    Cleaning up test database...

      at Object.<anonymous> (tests/setup/integration.setup.ts:54:11)

PASS integration tests/integration/Practice.integration.test.tsx
  Practice Page Integration
    Initial Rendering
      ✓ renders all main components (35 ms)
      ✓ initializes audio on mount (14 ms)
    Mode Switching
      ✓ switches between practice modes (20 ms)
      ✓ toggles ghost controls in debug mode (67 ms)
    Volume Control Integration
      ✓ updates master volume when volume control changes (11 ms)
    Music Player Integration
      ✓ updates current playing measure when music plays (11 ms)
      ✓ clears current playing measure when music stops (9 ms)
    Responsive Behavior
      ✓ shows mobile layout on small screens (20 ms)
      ✓ shows tablet layout on medium screens (4 ms)
      ✓ adjusts volume control size based on screen size (4 ms)
    Navigation
      ✓ navigates back when clicking back link (3 ms)
    Error Handling
      ✓ handles audio initialization failure gracefully (56 ms)
    Component Communication
      ✓ passes tempo from MusicPlayer to display (4 ms)
      ✓ coordinates between MusicPlayer and SheetMusicDisplay (4 ms)
    Cleanup
      ✓ removes resize event listener on unmount (2 ms)

PASS unit src/components/SheetMusicDisplay.test.tsx
  SheetMusicDisplay
    Rendering
      ✓ renders with sheet music content (25 ms)
      ✓ applies custom className (7 ms)
      ✓ renders navigation controls (10 ms)
      ✓ shows page indicator dots (2 ms)
    Page Navigation
      ✓ navigates to next page on button click (165 ms)
      ✓ navigates to previous page on button click (312 ms)
      ✓ disables previous button on first page (2 ms)
      ✓ disables next button on last page (1 ms)
      ✓ navigates to specific page via page dots (158 ms)
    Touch Navigation
      ✓ navigates to next page on swipe left (165 ms)
      ✓ navigates to previous page on swipe right (320 ms)
      ✓ does not navigate on small swipes (5 ms)
    Keyboard Navigation
      ✓ navigates with arrow keys (311 ms)
      ✓ cleans up keyboard event listeners on unmount (3 ms)
    Responsive Behavior
      ✓ adjusts layout for mobile portrait (2 ms)
      ✓ adjusts layout for tablet (1 ms)
      ✓ shows touch hint on mobile (4 ms)
      ✓ cleans up resize listener on unmount (2 ms)
    Auto Page Flip
      ✓ flips to correct page when currentPlayingMeasure changes (1 ms)
      ✓ does not flip if already on correct page (2 ms)
    Custom Measures Per Page
      ✓ respects custom measuresPerPage prop (1 ms)
      ✓ renders correct measures for each page (1 ms)
    Cleanup
      ✓ disposes NotationRenderer on unmount (1 ms)
      ✓ creates fresh renderer on page change (159 ms)

Test Suites: 1 failed, 9 passed, 10 total
Tests:       2 failed, 166 passed, 168 total
Snapshots:   0 total
Time:        2.992 s, estimated 3 s
Ran all test suites in 2 projects.
npm error Lifecycle script `test` failed with error:
npm error code 1
npm error path /Users/arbeitandy/src/public/rubato.pezware.com/frontend
npm error workspace @mirubato/frontend@0.1.0
npm error location /Users/arbeitandy/src/public/rubato.pezware.com/frontend
npm error command failed
npm error command sh -c jest --no-coverage --no-watch --passWithNoTests
